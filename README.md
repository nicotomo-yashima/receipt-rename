# receipt-rename

[Claude Code](https://docs.anthropic.com/en/docs/claude-code) 用スキル。ScanSnap等でスキャンしたレシート/領収書PDFのファイル名を、AIが中身を読み取って正しい形式に自動修正します。

## どんな問題を解決するか

ScanSnapなどのドキュメントスキャナーは、レシートをスキャンすると自動でOCRしてファイル名を付けてくれます。しかし実際には：

```
20260221_株式会社_(金額).pdf      ← 店名が「株式会社」だけ、金額未取得
20260221_<領収書>_500.pdf         ← 店名がタグのまま
20250314_0 3扱店長_4550.pdf       ← 完全に文字化け
20000418_ネ池袋店_4230.pdf        ← 年が2000年になっている
```

このスキルは、Claude Codeの画像認識能力を使ってPDFの中身を直接読み取り、正しいファイル名に修正します：

```
20250315_サイゼリヤ渋谷店_1200.pdf
20250320_スターバックス新宿店_500.pdf
20250314_うなぎしら河名駅店_4550.pdf
20250418_カイセンマーケットルミネ池袋店_4230.pdf
```

## 命名規則

```
YYYYMMDD_店名_金額.pdf
```

| 項目 | ルール |
|------|--------|
| 日付 | レシートに印字された取引日（スキャン日ではない）。YYYYMMDD形式 |
| 店名 | 店舗が特定できる名前。「株式会社」等は省略可 |
| 金額 | 合計金額（税込）。数字のみ、カンマなし |

## インストール

### 方法1: クローン（推奨）

```bash
git clone https://github.com/nicotomo-yashima/receipt-rename.git ~/.claude/skills/receipt-rename
```

### 方法2: 手動コピー

`SKILL.md` を `~/.claude/skills/receipt-rename/SKILL.md` に配置してください。

## 前提条件

- [Claude Code](https://docs.anthropic.com/en/docs/claude-code) がインストール済み
- macOS（`brew` でのインストールに対応。Linux の場合は `apt-get install poppler-utils`）
- `poppler`（初回実行時に自動インストールされます）

## 使い方

Claude Code 内で以下のコマンドを実行：

```
/receipt-rename                          # カレントディレクトリのPDFを処理
/receipt-rename ~/Desktop/レシート        # フォルダを指定して処理
```

## 処理の流れ

```
PDFファイル検出
    ↓
pdftoppmでPNG画像に変換（6ファイルずつ並列処理）
    ↓
Claude の画像認識で日付・店名・金額を読み取り
    ↓
現在のファイル名と照合
    ↓
修正一覧をテーブルで表示 → ユーザー確認
    ↓
リネーム実行 → 完了レポート出力
```

## 読み取り不能時のフォールバック

手書き領収書や印字が不鮮明な場合：

| 状況 | 命名例 |
|------|--------|
| 日付不明 | `(日付不明)_店名_金額.pdf` |
| 店名不明 | `YYYYMMDD_(店名不明)_金額.pdf` |
| 金額不明 | `YYYYMMDD_店名_(金額不明).pdf` |

## よくあるOCR誤りパターン

このスキルが検出・修正するよくある誤りパターンです：

| パターン | 例 | 原因 |
|----------|-----|------|
| 日付がスキャン日 | `20260101_...` | ScanSnapがスキャン日を使用 |
| 店名が「株式会社」だけ | `_株式会社_` | OCRがフッターの発行元だけ取得 |
| 金額が未取得 | `_(金額).pdf` | OCRが金額欄を認識できず |
| 文字化け | `_<店従業_` | OCR精度の問題 |
| 年が異常 | `20000418_` | OCRの数字誤認識 |

## ライセンス

MIT
