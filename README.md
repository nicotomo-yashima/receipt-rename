# receipt-rename

[Claude Code](https://docs.anthropic.com/en/docs/claude-code) 用スキル。ScanSnap等でスキャンしたレシート/領収書のファイル名を、AIが中身を読み取って正しい形式に自動修正します。

**対応形式**: PDF / JPG / JPEG / PNG

## どんな問題を解決するか

レシートや領収書のファイル名を手動で付けるのは面倒です。ScanSnapのOCRは誤認識が多く、スマホ撮影ではそもそもファイル名に情報がありません：

```
20260221_株式会社_(金額).pdf      ← OCR: 店名が「株式会社」だけ、金額未取得
20250314_0 3扱店長_4550.pdf       ← OCR: 完全に文字化け
scan001.pdf                       ← スキャナー出力そのまま（OCRリネームなし）
IMG_2048.jpg                      ← スマホ撮影でそもそも情報なし
```

このスキルは **ファイル名に関係なく、中身の画像を直接読み取って** 正しいファイル名を付けます：

```
20250315_サイゼリヤ渋谷店_1200.pdf
20250314_うなぎしら河名駅店_4550.pdf
20250320_スターバックス新宿店_500.pdf
20250418_カイセンマーケット池袋店_4230.jpg
```

OCRリネーム済み・未リネーム・スマホ撮影、いずれも対応します。

## 命名規則

```
YYYYMMDD_店名_金額.{pdf,jpg,png}
```

| 項目 | ルール |
|------|--------|
| 日付 | レシートに印字された取引日（スキャン日ではない）。YYYYMMDD形式 |
| 店名 | 店舗が特定できる名前。「株式会社」等は省略可 |
| 金額 | 合計金額（税込）。数字のみ、カンマなし |
| 拡張子 | 元のファイルの拡張子をそのまま維持 |

## インストール

### 方法1: クローン（推奨）

```bash
git clone https://github.com/nicotomo-yashima/receipt-rename.git ~/.claude/skills/receipt-rename
```

### 方法2: 手動コピー

`SKILL.md` を `~/.claude/skills/receipt-rename/SKILL.md` に配置してください。

## 前提条件

- [Claude Code](https://docs.anthropic.com/en/docs/claude-code) がインストール済み
- **PDFを扱う場合**: `poppler` が必要（初回実行時に自動インストール）
  - macOS: `brew install poppler`
  - Linux: `apt-get install poppler-utils`
- **JPG/PNGのみの場合**: 追加依存なし

## 使い方

Claude Code 内で以下のコマンドを実行：

```
/receipt-rename                          # カレントディレクトリのファイルを処理
/receipt-rename ~/Desktop/レシート        # フォルダを指定して処理
```

## 処理の流れ

```
PDF/JPG/PNG ファイル検出
    ↓
┌─ PDF → pdftoppm で PNG に変換
└─ JPG/PNG → そのまま（変換不要）
    ↓
Claude の画像認識で日付・店名・金額を読み取り（6ファイルずつ並列）
    ↓
現在のファイル名と照合
    ↓
修正一覧をテーブルで表示 → ユーザー確認
    ↓
リネーム実行 → 完了レポート出力
```

## 読み取り不能時のフォールバック

手書き領収書や印字が不鮮明な場合：

| 状況 | 命名例 |
|------|--------|
| 日付不明 | `(日付不明)_店名_金額.pdf` |
| 店名不明 | `YYYYMMDD_(店名不明)_金額.jpg` |
| 金額不明 | `YYYYMMDD_店名_(金額不明).png` |

## よくあるOCR誤りパターン

このスキルが検出・修正するよくある誤りパターンです：

| パターン | 例 | 原因 |
|----------|-----|------|
| 日付がスキャン日 | `20260101_...` | ScanSnapがスキャン日を使用 |
| 店名が「株式会社」だけ | `_株式会社_` | OCRがフッターの発行元だけ取得 |
| 金額が未取得 | `_(金額).pdf` | OCRが金額欄を認識できず |
| 文字化け | `_<店従業_` | OCR精度の問題 |
| 年が異常 | `20000418_` | OCRの数字誤認識 |
| 情報なし | `IMG_2048.jpg` | スマホ撮影で命名情報なし |
| 連番のまま | `scan001.pdf` | OCRリネーム未実施 |

## ライセンス

MIT
